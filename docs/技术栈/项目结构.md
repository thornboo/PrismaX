# 项目结构

> 本文档描述 PrismaX-Desktop 桌面应用的项目结构

---

## 目录结构

```
prismax-desktop/
├── src/                          # 渲染进程（Vite + React）
│   ├── components/               # UI 组件
│   │   ├── chat/                 # 聊天组件
│   │   │   ├── ChatInput.tsx     # 输入框
│   │   │   ├── MessageList.tsx   # 消息列表
│   │   │   ├── MessageBubble.tsx # 消息气泡
│   │   │   └── MarkdownRenderer.tsx # Markdown 渲染
│   │   │
│   │   ├── sidebar/              # 侧边栏组件
│   │   │   ├── Sidebar.tsx       # 侧边栏容器
│   │   │   ├── ConversationList.tsx # 会话列表
│   │   │   └── ConversationItem.tsx # 会话项
│   │   │
│   │   ├── tabs/                 # 标签页组件
│   │   │   ├── TabBar.tsx        # 标签栏
│   │   │   └── TabContent.tsx    # 标签内容
│   │   │
│   │   ├── settings/             # 设置组件
│   │   │   ├── SettingsPanel.tsx # 设置面板
│   │   │   ├── ModelConfig.tsx   # 模型配置
│   │   │   └── ThemeSwitch.tsx   # 主题切换
│   │   │
│   │   └── ui/                   # shadcn/ui 基础组件
│   │       ├── button.tsx
│   │       ├── input.tsx
│   │       ├── dialog.tsx
│   │       ├── dropdown-menu.tsx
│   │       └── ...
│   │
│   ├── pages/                    # 页面组件
│   │   ├── Chat.tsx              # 聊天页面
│   │   ├── Settings.tsx          # 设置页面
│   │   └── Welcome.tsx           # 欢迎页面
│   │
│   ├── hooks/                    # 自定义 Hooks
│   │   ├── use-chat.ts           # 聊天逻辑
│   │   ├── use-ipc.ts            # IPC 通信
│   │   ├── use-theme.ts          # 主题管理
│   │   └── use-keyboard.ts       # 快捷键
│   │
│   ├── stores/                   # Zustand 状态管理
│   │   ├── chat.ts               # 聊天状态
│   │   ├── settings.ts           # 设置状态
│   │   ├── tabs.ts               # 标签页状态
│   │   └── index.ts              # 导出
│   │
│   ├── lib/                      # 工具函数
│   │   ├── ipc.ts                # IPC 客户端封装
│   │   ├── utils.ts              # 通用工具
│   │   └── cn.ts                 # className 合并
│   │
│   ├── types/                    # 类型定义
│   │   ├── chat.ts               # 聊天相关类型
│   │   ├── settings.ts           # 设置相关类型
│   │   ├── electron.d.ts         # Electron API 类型
│   │   └── index.ts              # 导出
│   │
│   ├── styles/                   # 样式文件
│   │   └── globals.css           # 全局样式
│   │
│   ├── App.tsx                   # 根组件
│   ├── main.tsx                  # 入口文件
│   └── router.tsx                # 路由配置
│
├── electron/                     # 主进程
│   ├── main.ts                   # 主进程入口
│   ├── preload.ts                # 预加载脚本
│   │
│   ├── ipc/                      # IPC 处理器
│   │   ├── index.ts              # IPC 注册
│   │   ├── chat.ts               # 聊天相关
│   │   ├── database.ts           # 数据库操作
│   │   └── system.ts             # 系统功能
│   │
│   ├── services/                 # 业务服务
│   │   ├── chat-service.ts       # 聊天服务
│   │   ├── ai-provider.ts        # AI Provider
│   │   └── database.ts           # 数据库服务
│   │
│   ├── db/                       # 数据库
│   │   ├── schema.ts             # Drizzle Schema
│   │   ├── migrations/           # 数据库迁移
│   │   └── index.ts              # 数据库初始化
│   │
│   ├── tray.ts                   # 系统托盘
│   ├── updater.ts                # 更新检查
│   └── window.ts                 # 窗口管理
│
├── resources/                    # 资源文件
│   └── icons/                    # 应用图标
│       ├── icon.icns             # macOS
│       ├── icon.ico              # Windows
│       └── icon.png              # Linux
│
├── docs/                         # 项目文档
│   ├── overview.md               # 项目概述
│   ├── migration-plan.md         # 改造计划
│   ├── tech-stack/               # 技术栈文档
│   ├── architecture/             # 架构文档
│   └── guides/                   # 开发指南
│
├── index.html                    # HTML 入口
├── vite.config.ts                # Vite 配置
├── electron-builder.json         # 打包配置
├── tsconfig.json                 # TypeScript 配置
├── tsconfig.node.json            # Node TypeScript 配置
├── tailwind.config.js            # Tailwind 配置
├── postcss.config.js             # PostCSS 配置
├── package.json                  # 项目配置
└── README.md                     # 项目说明
```

---

## 模块职责

### src/ - 渲染进程

React 应用，负责用户界面：

- **components/** - UI 组件库
- **pages/** - 页面组件
- **hooks/** - 自定义 Hooks
- **stores/** - 状态管理
- **lib/** - 工具函数
- **types/** - 类型定义

### electron/ - 主进程

Electron 主进程，负责系统集成：

- **main.ts** - 应用入口，窗口创建
- **preload.ts** - 安全 API 暴露
- **ipc/** - IPC 通信处理
- **services/** - 业务逻辑
- **db/** - 数据库操作
- **tray.ts** - 系统托盘
- **updater.ts** - 更新检查

---

## 数据流

```
┌─────────────────────────────────────────────────────────────┐
│                      渲染进程 (React)                        │
│  ┌─────────┐    ┌─────────┐    ┌─────────┐                 │
│  │  组件   │───▶│  Store  │───▶│   IPC   │                 │
│  │ (View)  │◀───│(Zustand)│◀───│ Client  │                 │
│  └─────────┘    └─────────┘    └────┬────┘                 │
└─────────────────────────────────────┼───────────────────────┘
                                      │ IPC
┌─────────────────────────────────────┼───────────────────────┐
│                      主进程 (Electron)                       │
│                                ┌────┴────┐                  │
│                                │   IPC   │                  │
│                                │ Handler │                  │
│                                └────┬────┘                  │
│         ┌──────────────────────────┼──────────────────────┐ │
│         │                          │                      │ │
│         ▼                          ▼                      ▼ │
│  ┌─────────────┐           ┌─────────────┐        ┌───────┐ │
│  │   Service   │           │   Database  │        │  AI   │ │
│  │  (业务逻辑) │           │   (SQLite)  │        │ API   │ │
│  └─────────────┘           └─────────────┘        └───────┘ │
└─────────────────────────────────────────────────────────────┘
```

---

## 配置文件说明

### package.json

```json
{
  "name": "prismax-desktop",
  "version": "0.1.0",
  "main": "electron-dist/main.js",
  "scripts": {
    "dev": "vite",
    "dev:electron": "concurrently \"vite\" \"wait-on tcp:5173 && electron .\"",
    "build": "vite build",
    "build:electron": "tsc -p electron/tsconfig.json",
    "build:all": "pnpm build && pnpm build:electron",
    "package": "pnpm build:all && electron-builder",
    "lint": "eslint . --ext .ts,.tsx",
    "type-check": "tsc --noEmit"
  }
}
```

### vite.config.ts

```typescript
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";
import path from "path";

export default defineConfig({
  plugins: [react()],
  base: "./",
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "src"),
    },
  },
  build: {
    outDir: "dist",
  },
  server: {
    port: 5173,
  },
});
```

### tsconfig.json

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["src"],
  "references": [{ "path": "./tsconfig.node.json" }]
}
```

---

## 开发命令

```bash
# 安装依赖
pnpm install

# 启动开发服务器（仅前端）
pnpm dev

# 启动 Electron 开发环境
pnpm dev:electron

# 构建前端
pnpm build

# 构建主进程
pnpm build:electron

# 打包应用
pnpm package

# 代码检查
pnpm lint

# 类型检查
pnpm type-check
```
